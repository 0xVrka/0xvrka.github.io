---
// Component imports
import Main from "../layouts/MainLayout.astro";
import PostCard from "../components/PostCard.astro";
import Pagination from "../components/controllers/Pagination.astro";
// Utils
import type { PaginateFunction } from "astro";
import { GetSortedPosts } from "../utils/content";

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction;
}) {
  const postCollections = await GetSortedPosts();
  return paginate(postCollections, { pageSize: 6 });
}
const { page } = Astro.props;
---

<Main title="Home">
  <div id="posts-wrapper" class="space-y-8">
    <div class="space-y-4">
      {
        page.data.map((entry, index) => (
          <div
            class="onload-animation"
            style={`animation-delay: calc(var(--onload-animation-delay) + ${index + 1} * var(--onload-animation-interval));`}
          >
            <PostCard
              id={entry.id}
              title={entry.data.title}
              published={entry.data.published}
              category={entry.data.category}
              tags={entry.data.tags}
              description={entry.data.description}
              image={entry.data.cover}
              readingMetadata={
                (entry.rendered!.metadata as any).frontmatter.readingMetadata
              }
            />
          </div>
        ))
      }
    </div>
  </div>

<div id="pagination-wrapper" class="mt-8 flex justify-center">
  <Pagination
    class="onload-animation"
    lastPage={page.lastPage}
    current={page.currentPage}
    prevURL={page.url.prev}
    nextURL={page.url.next}
    style={`animation-delay: calc(var(--onload-animation-delay) + ${page.data.length + 1} * var(--onload-animation-interval));`}
  />
</div>
</Main>

<style>
  #pagination-wrapper {
    transform: translateX(-120px);
  }

  @media (max-width: 62rem) {
    #pagination-wrapper {
      transform: none;
    }
  }
</style>
